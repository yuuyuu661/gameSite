<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„Çπ„É≠„ÉÉ„Éà„Éû„Ç∑„É≥Ôºà„Çπ„Çø„É≥„Éâ„Ç¢„É≠„É≥Ôºâ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light only; }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif; text-align: center; background-color: #0c1b2a; color: #fff; margin: 24px; }
    h1 { font-size: 1.4rem; margin: 0 0 8px; }
    #payoutTable { display:block; width: min(95vw, 680px); margin: 8px auto 12px; }
    .slot-container { display: flex; justify-content: center; gap: 8px; width: min(95vw, 650px); height: 400px; margin: 0 auto 8px; overflow: hidden; }
    .reel-wrapper { display:flex; flex-direction:column; align-items:center; }
    .reel { width: 100px; height: 400px; overflow: hidden; background: #222; border: 3px solid gold; box-shadow: 0 0 10px gold; }
    .symbols { position: relative; top: 0; width: 100%; }
    .symbol { display:flex; align-items:center; justify-content:center; height:100px; }
    .symbol img { width:80px; height:80px; display:block; }
    .stop-btn, #start { font-size: 16px; padding: 6px 12px; margin-top: 6px; border-radius: 10px; border: none; cursor: pointer; }
    #start { background: #33c6ff; }
    .stop-btn { background: #ffce33; }
    #coinDisplay { margin-top: 8px; }
    #result { margin-top: 10px; min-height: 1.5em; }
    .highlight { outline: 3px solid #0ff; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>„Çπ„É≠„ÉÉ„Éà„Éû„Ç∑„É≥Ôºà„Çπ„Çø„É≥„Éâ„Ç¢„É≠„É≥Ôºâ</h1>

  <audio id="startSound" src="sounds/start.mp3" preload="auto"></audio>
  <audio id="stopSound"  src="sounds/stop.mp3" preload="auto"></audio>
  <audio id="winSound"   src="sounds/win3.mp3" preload="auto"></audio>
  <audio id="loseSound"  src="sounds/win4.mp3" preload="auto"></audio>
  <audio id="bgmNormal"  src="sounds/bgm_normal.mp3" preload="auto" loop></audio>
  <audio id="bgmBonus"   src="sounds/bgm_bonus.mp3"  preload="auto" loop></audio>

  <img src="images/payout_table.png" alt="„Éö„Ç§„ÉÜ„Éº„Éñ„É´" id="payoutTable">

  <div class="slot-container" id="slotContainer">
    <div class="reel-wrapper"><div class="reel"><div class="symbols"></div></div><button class="stop-btn" data-index="0">STOP</button></div>
    <div class="reel-wrapper"><div class="reel"><div class="symbols"></div></div><button class="stop-btn" data-index="1">STOP</button></div>
    <div class="reel-wrapper"><div class="reel"><div class="symbols"></div></div><button class="stop-btn" data-index="2">STOP</button></div>
    <div class="reel-wrapper"><div class="reel"><div class="symbols"></div></div><button class="stop-btn" data-index="3">STOP</button></div>
    <div class="reel-wrapper"><div class="reel"><div class="symbols"></div></div><button class="stop-btn" data-index="4">STOP</button></div>
  </div>

  <button id="start">„Çπ„Çø„Éº„ÉàÔºÅ</button>
  <div id="coinDisplay">ÊâÄÊåÅ„Ç≥„Ç§„É≥: <span id="coins">100</span></div>
  <div id="volumeControl" style="margin-top: 10px;">üîä BGMÈü≥Èáè: <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5"></div>
  <div id="result"></div>

<script>
  const symbols = [
    { name: "seven", src: "images/seven.png", bonus: false },
    { name: "orb",   src: "images/orb.png",   bonus: true  },
    { name: "slime", src: "images/slime.png", bonus: false },
    { name: "lemon", src: "images/lemon.png", bonus: false },
    { name: "grape", src: "images/grape.png", bonus: false },
    { name: "bell",  src: "images/bell.png",  bonus: false },
    { name: "gem",   src: "images/gem.png",   bonus: false }
  ];
  const symbolWeights = [6, 6, 10, 12, 18, 20, 28];

  const reels = Array.from(document.querySelectorAll(".reel"));
  const reelCount = reels.length;
  const rowsVisible = 3;
  const coinsEl   = document.getElementById("coins");
  const resultEl  = document.getElementById("result");
  const startBtn  = document.getElementById("start");
  const volumeSlider = document.getElementById("volumeSlider");
  const winSound  = document.getElementById("winSound");
  const loseSound = document.getElementById("loseSound");
  const bgmNormal = document.getElementById("bgmNormal");
  const bgmBonus  = document.getElementById("bgmBonus");
  const startSound= document.getElementById("startSound");
  const stopSound = document.getElementById("stopSound");

  bgmNormal.loop = true; bgmBonus.loop = true;
  bgmNormal.volume = 0.5; bgmBonus.volume  = 0.5;

  let coins = 100;
  let spinningFlags = [];
  let slowingFlags  = [];
  let hasChecked = false;

  function getRandomSymbol(){
    const total = symbolWeights.reduce((a,b)=>a+b);
    let r = Math.random()*total, acc = 0;
    for(let i=0;i<symbols.length;i++){ acc+=symbolWeights[i]; if(r<acc) return symbols[i]; }
    return symbols[symbols.length-1];
  }
  function createSymbolDiv(symbol){
    const div = document.createElement("div");
    div.className = "symbol";
    const img = document.createElement("img");
    img.src = symbol.src; img.alt = symbol.name;
    div.appendChild(img);
    return div;
  }
  function setupReels(){
    reels.forEach(reel=>{
      const c = reel.querySelector(".symbols");
      c.innerHTML = "";
      for(let i=0;i<20;i++) c.appendChild(createSymbolDiv(getRandomSymbol()));
      c.style.top = "0px";
    });
  }
  function startReel(index){
    const c = reels[index].querySelector(".symbols");
    let pos = 0, speed = 20;
    function anim(){
      pos += speed;
      if(pos >= 100){
        pos %= 100;
        c.insertBefore(c.lastElementChild, c.firstElementChild);
      }
      c.style.top = `-${pos}px`;
      if(slowingFlags[index]){
        speed = Math.max(4, speed*0.94);
        if(speed <= 4){
          c.style.top = "0px";
          spinningFlags[index] = false;
          stopSound.currentTime = 0; stopSound.play();
          if(!spinningFlags.some(f=>f) && !hasChecked){
            hasChecked = true;
            checkWinLines();
          }
          return;
        }
      }
      requestAnimationFrame(anim);
    }
    requestAnimationFrame(anim);
  }
  function stopReel(index){ slowingFlags[index] = true; }
  function getVisibleSymbols(){
    const visible = [[],[],[]];
    reels.forEach((reel, col)=>{
      const c = reel.querySelector(".symbols");
      const top = parseFloat(c.style.top)||0;
      const off = Math.max(0, Math.min(c.children.length-rowsVisible, Math.round(-top/100)));
      const children = c.children;
      for(let row=0; row<rowsVisible; row++){
        const el = children[off+row];
        visible[row][col] = el?.querySelector("img")?.alt || "";
      }
    });
    return visible;
  }
  function checkWinLines(){
    const visible = getVisibleSymbols();
    const line = visible[1];
    let maxCount = 1, cur = 1;
    for(let i=1;i<line.length;i++){
      if(line[i] && line[i]===line[i-1]) { cur++; maxCount = Math.max(maxCount, cur); }
      else cur = 1;
    }
    if(maxCount>=3){
      resultEl.textContent = `WIN! ‰∏≠ÊÆµ„Åß${maxCount}„Å§ÊèÉ„ÅÑ`;
      winSound.currentTime = 0; winSound.play();
      coins += maxCount*5;
    }else{
      resultEl.textContent = "ÊÆãÂøµÔºÅ";
      loseSound.currentTime = 0; loseSound.play();
    }
    coinsEl.textContent = coins;
  }
  document.querySelectorAll(".stop-btn").forEach(btn=>{
    btn.addEventListener("click", ()=> stopReel(+btn.dataset.index));
  });
  startBtn.addEventListener("click", ()=>{
    if(spinningFlags.some(f=>f)) return;
    hasChecked = false;
    if(coins < 10) { resultEl.textContent = "„Ç≥„Ç§„É≥„ÅåË∂≥„Çä„Åæ„Åõ„Çì„ÄÇ"; return; }
    startSound.currentTime = 0; startSound.play();
    coins -= 10; coinsEl.textContent = coins;
    resultEl.textContent = "";
    setupReels();
    spinningFlags = Array(reelCount).fill(true);
    slowingFlags  = Array(reelCount).fill(false);
    for(let i=0;i<reelCount;i++) startReel(i);
  });
  volumeSlider.addEventListener("input", ()=>{
    const v = parseFloat(volumeSlider.value)||0;
    bgmNormal.volume = v; bgmBonus.volume = v;
  });
  setupReels();
  document.body.addEventListener("click", ()=>{
    if(bgmNormal.paused){ bgmNormal.play().catch(()=>{}); }
  }, { once:true });
</script>
</body>
</html>
