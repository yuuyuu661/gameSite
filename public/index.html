<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Mini Games</title>
  <link rel="stylesheet" href="/style.css"/>

<script type="module">
  import { 
    getDisplayName,
    setDisplayName,
    getPoints
  } from "/js/common.js";

  async function refresh() {
    const name = getDisplayName();
    const nameText = document.querySelector("#playerNameText");
    const overlay = document.querySelector("#name-overlay");
    const pointsEl = document.querySelector("#points");

    if (!name) {
      overlay.style.display = "flex";
      nameText.textContent = "未設定";
      pointsEl.textContent = "-";
      return;
    }

    overlay.style.display = "none";
    nameText.textContent = name;

    try {
      const pts = await getPoints();
      pointsEl.textContent = pts.points ?? 0;
    } catch (e) {
      pointsEl.textContent = "-";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const overlayInput = document.querySelector("#overlayName");
    const overlayOk = document.querySelector("#overlay-ok");

    overlayOk.addEventListener("click", () => {
      const v = overlayInput.value.trim();
      if (!v) {
        alert("プレイヤー名を入力してください");
        return;
      }
      setDisplayName(v);
      refresh();
    });

    refresh();
  });
</script>
</head>

<body>
  <div class="name-overlay" id="name-overlay">
      <div class="name-overlay-card">
        <h2>プレイヤー名を入力</h2>
        <p class="small">ポイント・ランキングに使用する名前です。</p>
        <input id="overlayName" type="text" placeholder="例）ゆう" />
        <button id="overlay-ok" style="margin-top:10px;">OK</button>
      </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>ミニゲーム</h1>
      <div class="kv">
        <span class="small">プレイヤー名</span>
        <b id="playerNameText">未設定</b>
      </div>
      <div class="kv">
        <span class="small">所持ポイント</span>
        <b id="points">-</b>
      </div>
      <div class="kv" style="margin-top:10px;">
        <a class="game" href="/leaderboards.html">🏆 ランキングを見る</a>
      </div>
    </div>

    <div class="card">
      <h3>ミニゲーム一覧</h3>
      <div class="list">
        <a class="game" href="/games/aim/index.html">エイム練習（Aim）</a>
        <a class="game" href="/games/memory/index.html">神経衰弱（Memory）</a>
        <a class="game" href="/games/numbers/index.html">数字タップ（Numbers）</a>
        <a class="game" href="/games/fusion/index.html">ポケモンフュージョンクイズ（Quiz）</a>
        <a class="game" href="/games/block/index.html">ブロックブラスト（Block）</a>
      </div>
    </div>

  </div>
</body>
</html>
