<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>反射神経（Reaction）</title>
<link rel="stylesheet" href="/style.css"/>
<script type="module">
import { submitScore, getPlayer } from "/js/common.js";

let startBtn, info, playing=false, startTime=0, timeoutId=0;
function ui(state="wait"){
  const el = document.querySelector("#game");
  el.style.minHeight = "220px";
  el.innerHTML = `
    <div class="list">
      <div>合図が緑になったらクリック！ 早いほど高スコア</div>
      <button id="start">スタート</button>
      <div id="info" class="small"></div>
    </div>`;
  startBtn = document.querySelector("#start");
  info = document.querySelector("#info");
  startBtn.onclick = begin;
}
function begin(){
  if(playing) return;
  playing = true; info.textContent = "赤 → 緑まで待って…";
  const el = document.querySelector("#game");
  el.style.background = "#4a1717";
  const delay = 1000 + Math.random()*2000;
  clearTimeout(timeoutId);
  timeoutId = setTimeout(()=>{
    el.style.background = "#174a2a";
    info.textContent = "今だ！クリック！";
    startTime = performance.now();
    el.onclick = clicked;
  }, delay);
}
function clicked(){
  if(!playing) return;
  const rt = Math.round(performance.now() - startTime); // ms
  const score = Math.max(0, 1000 - rt);
  playing = false; document.querySelector("#game").onclick = null;
  document.querySelector("#game").style.background = "";
  info.innerHTML = `反応時間: <b>${rt}ms</b> → スコア <b>${score}</b>`;
  submitScore("reaction", score).then(r=>{
    if(r?.ok!==false){
      info.innerHTML += `　獲得ポイント: <b>${r.addedPoints}</b>`;
    }
  });
}
document.addEventListener("DOMContentLoaded", ()=>ui());

</script>
</head><body>
<div class="container">
  <div class="header">
    <h1>反射神経（Reaction）</h1>
    <a class="game" href="/">← メニューへ</a>
  </div>
  <div class="card" id="game"></div>
</div>
</body></html>