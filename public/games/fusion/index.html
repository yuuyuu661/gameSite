<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>ポケモンフュージョンクイズ</title>
  <link rel="stylesheet" href="/style.css" />

  <script type="module">
    import { submitScore } from "/js/common.js";

    // ★ここに「参考サイトからコピペした画像URL」と「元ポケモン名」を登録してください
    const FUSIONS = [
      {
        id: 1,
        image: "https://images.alexonsager.net/pokemon/fused/25/25.54.png",
        left: "ピカチュウ",
        right: "コダック",
      },
      {
        id: 2,
        image: "https://images.alexonsager.net/pokemon/fused/1/1.7.png",
        left: "フシギダネ",
        right: "ゼニガメ",
      },
      {
        id: 3,
        image: "https://images.alexonsager.net/pokemon/fused/4/4.39.png",
        left: "ヒトカゲ",
        right: "プリン",
      },
     { id: 4,   image: "https://images.alexonsager.net/pokemon/fused/72/72.104.png", left: "カラカラ", right: "メノクラゲ" },
     { id: 5,   image: "https://images.alexonsager.net/pokemon/fused/95/95.25.png", left: "ピカチュウ", right: "イワーク" },
     { id: 6,   image: "https://images.alexonsager.net/pokemon/fused/69/69.116.png", left: "タッツー", right: "マダツボミ" },
     { id: 7,   image: "https://images.alexonsager.net/pokemon/fused/50/50.36.png", left: "ピクシー", right: "ディグダ" },
     { id: 8,   image: "https://images.alexonsager.net/pokemon/fused/90/90.13.png", left: "ビードル", right: "シェルダー" },
     { id: 9,   image: "https://images.alexonsager.net/pokemon/fused/33/33.72.png", left: "メノクラゲ", right: "ニドリーノ" },
     { id: 10,   image: "https://images.alexonsager.net/pokemon/fused/125/125.105.png", left: "ガラガラ", right: "エレブー" },
     { id: 11,   image: "https://images.alexonsager.net/pokemon/fused/49/49.34.png", left: "ニドキング", right: "モルフォン" },
     { id: 12,   image: "https://images.alexonsager.net/pokemon/fused/72/72.30.png", left: "ニドリーナ", right: "メノクラゲ" },
     { id: 13,   image: "https://images.alexonsager.net/pokemon/fused/5/5.117.png", left: "シードラ", right: "リザード" },
     { id: 14,   image: "https://images.alexonsager.net/pokemon/fused/19/19.146.png", left: "ファイヤー", right: "コラッタ" },
     { id: 15,   image: "https://images.alexonsager.net/pokemon/fused/94/94.21.png", left: "オニスズメ", right: "ゲンガー" },
     { id: 16,   image: "https://images.alexonsager.net/pokemon/fused/122/122.28.png", left: "サンドパン", right: "バリヤード" },
     { id: 17,   image: "https://images.alexonsager.net/pokemon/fused/137/137.85.png", left: "ドードリオ", right: "ポリゴン" },
     { id: 18,   image: "https://images.alexonsager.net/pokemon/fused/126/126.58.png", left: "ガーディ", right: "ブーバー" },
     { id: 19,   image: "https://images.alexonsager.net/pokemon/fused/57/57.147.png", left: "ミニリュウ", right: "オコリザル" },
     { id: 20,   image: "https://images.alexonsager.net/pokemon/fused/141/141.84.png", left: "ドードー", right: "カブトプス" },
     { id: 21,   image: "https://images.alexonsager.net/pokemon/fused/80/80.104.png", left: "カラカラ", right: "ヤドラン" },
     { id: 22,   image: "https://images.alexonsager.net/pokemon/fused/142/142.130.png", left: "ギャラドス", right: "プテラ" },
     { id: 23,   image: "https://images.alexonsager.net/pokemon/fused/77/77.28.png", left: "サンドパン", right: "ポニータ" },
     { id: 24,   image: "https://images.alexonsager.net/pokemon/fused/11/11.57.png", left: "オコリザル", right: "トランセル" },
     { id: 25,   image: "https://images.alexonsager.net/pokemon/fused/50/50.108.png", left: "ベロリンガ", right: "ディグダ" },
     { id: 26,   image: "https://images.alexonsager.net/pokemon/fused/3/3.75.png", left: "ゴローン", right: "フシギバナ" },
     { id: 27,   image: "https://images.alexonsager.net/pokemon/fused/96/96.24.png", left: "アーボック", right: "スリープ" },
     { id: 28,   image: "https://images.alexonsager.net/pokemon/fused/100/100.111.png", left: "サイホーン", right: "ビリリダマ" },
     { id: 29,   image: "https://images.alexonsager.net/pokemon/fused/113/113.59.png", left: "ウィンディ", right: "ラッキー" },
     { id: 30,   image: "https://images.alexonsager.net/pokemon/fused/104/104.100.png", left: "ビリリダマ", right: "カラカラ" },
     { id: 31,   image: "https://images.alexonsager.net/pokemon/fused/107/107.96.png", left: "スリープ", right: "エビワラー" },
     { id: 32,   image: "https://images.alexonsager.net/pokemon/fused/65/65.99.png", left: "キングラー", right: "フーディン" },
     { id: 33,   image: "https://images.alexonsager.net/pokemon/fused/32/32.100.png", left: "ビリリダマ", right: "ニドラン♂" },
     { id: 34,   image: "https://images.alexonsager.net/pokemon/fused/27/27.21.png", left: "オニスズメ", right: "サンド" },
     { id: 35,   image: "https://images.alexonsager.net/pokemon/fused/137/137.123.png", left: "ストライク", right: "ポリゴン" },
     { id: 36,   image: "https://images.alexonsager.net/pokemon/fused/63/63.41.png", left: "ズバット", right: "ケーシィ" },
     { id: 37,   image: "https://images.alexonsager.net/pokemon/fused/124/124.12.png", left: "バタフリー", right: "ルージュラ" },
     { id: 38,   image: "https://images.alexonsager.net/pokemon/fused/17/17.5.png", left: "リザード", right: "ピジョン" },
     { id: 39,   image: "https://images.alexonsager.net/pokemon/fused/66/66.95.png", left: "イワーク", right: "ワンリキー" },
     { id: 40,   image: "https://images.alexonsager.net/pokemon/fused/25/25.112.png", left: "サイドン", right: "ピカチュウ" },
     { id: 41,   image: "https://images.alexonsager.net/pokemon/fused/47/47.16.png", left: "ポッポ", right: "パラセクト" },
     { id: 42,   image: "https://images.alexonsager.net/pokemon/fused/78/78.148.png", left: "ハクリュー", right: "ギャロップ" },
     { id: 43,   image: "https://images.alexonsager.net/pokemon/fused/27/27.124.png", left: "ルージュラ", right: "サンド" },
     { id: 44,   image: "https://images.alexonsager.net/pokemon/fused/37/37.134.png", left: "シャワーズ", right: "ロコン" },
     { id: 45,   image: "https://images.alexonsager.net/pokemon/fused/75/75.116.png", left: "タッツー", right: "ゴローン" },
     { id: 46,   image: "https://images.alexonsager.net/pokemon/fused/101/101.52.png", left: "ニャース", right: "マルマイン" },
     { id: 47,   image: "https://images.alexonsager.net/pokemon/fused/47/47.20.png", left: "ラッタ", right: "パラセクト" },
     { id: 48,   image: "https://images.alexonsager.net/pokemon/fused/147/147.115.png", left: "ガルーラ", right: "ミニリュウ" },
     { id: 49,   image: "https://images.alexonsager.net/pokemon/fused/55/55.123.png", left: "ストライク", right: "ゴルダック" },
     { id: 50,   image: "https://images.alexonsager.net/pokemon/fused/22/22.120.png", left: "ヒトデマン", right: "オニドリル" },
     { id: 51,   image: "https://images.alexonsager.net/pokemon/fused/116/116.146.png", left: "ファイヤー", right: "タッツー" },
     { id: 52,   image: "https://images.alexonsager.net/pokemon/fused/118/118.47.png", left: "パラセクト", right: "トサキント" },
     { id: 53,   image: "https://images.alexonsager.net/pokemon/fused/40/40.107.png", left: "エビワラー", right: "プクリン" },
     { id: 54,   image: "https://images.alexonsager.net/pokemon/fused/117/117.67.png", left: "ゴーリキ", right: "シードラ" },
     { id: 55,   image: "https://images.alexonsager.net/pokemon/fused/106/106.12.png", left: "バタフリー", right: "サワムラー" },
     { id: 56,   image: "https://images.alexonsager.net/pokemon/fused/85/85.39.png", left: "プリン", right: "ドードリオ" },
     { id: 57,   image: "https://images.alexonsager.net/pokemon/fused/48/48.44.png", left: "クサイハナ", right: "コンパン" },
     { id: 58,   image: "https://images.alexonsager.net/pokemon/fused/26/26.142.png", left: "プテラ", right: "ライチュウ" },
     { id: 59,   image: "https://images.alexonsager.net/pokemon/fused/77/77.114.png", left: "モンジャラ", right: "ポニータ" },
     { id: 60,   image: "https://images.alexonsager.net/pokemon/fused/95/95.107.png", left: "エビワラー", right: "イワーク" },
     { id: 61,   image: "https://images.alexonsager.net/pokemon/fused/139/139.81.png", left: "コイル", right: "オムスター" },
     { id: 62,   image: "https://images.alexonsager.net/pokemon/fused/6/6.17.png", left: "ピジョン", right: "リザードン" },
     { id: 63,   image: "https://images.alexonsager.net/pokemon/fused/94/94.64.png", left: "ユンゲラー", right: "ゲンガー" },
     { id: 64,   image: "https://images.alexonsager.net/pokemon/fused/24/24.109.png", left: "ドガース", right: "アーボック" },
     { id: 65,   image: "https://images.alexonsager.net/pokemon/fused/80/80.78.png", left: "ギャロップ", right: "ヤドラン" },
     { id: 66,   image: "https://images.alexonsager.net/pokemon/fused/18/18.146.png", left: "ファイヤー", right: "ピジョット" },
     { id: 67,   image: "https://images.alexonsager.net/pokemon/fused/134/134.107.png", left: "エビワラー", right: "シャワーズ" },
     { id: 68,   image: "https://images.alexonsager.net/pokemon/fused/79/79.54.png", left: "コダック", right: "ヤドン" },
     { id: 69,   image: "https://images.alexonsager.net/pokemon/fused/116/116.86.png", left: "パウワウ", right: "タッツー" },
     { id: 70,   image: "https://images.alexonsager.net/pokemon/fused/82/82.146.png", left: "ファイヤー", right: "レアコイル" },
     { id: 71,   image: "https://images.alexonsager.net/pokemon/fused/140/140.49.png", left: "モルフォン", right: "カブト" },
     { id: 72,   image: "https://images.alexonsager.net/pokemon/fused/95/95.2.png", left: "フシギソウ", right: "イワーク" },
     { id: 73,   image: "https://images.alexonsager.net/pokemon/fused/134/134.136.png", left: "ブースター", right: "シャワーズ" },
     { id: 74,   image: "https://images.alexonsager.net/pokemon/fused/20/20.13.png", left: "ビードル", right: "ラッタ" },
     { id: 75,   image: "https://images.alexonsager.net/pokemon/fused/5/5.61.png", left: "ニョロゾ", right: "リザード" },
     { id: 76,   image: "https://images.alexonsager.net/pokemon/fused/29/29.68.png", left: "カイリキー", right: "ニドラン♀" },
     { id: 77,   image: "https://images.alexonsager.net/pokemon/fused/6/6.42.png", left: "ゴルバット", right: "リザードン" },
     { id: 78,   image: "https://images.alexonsager.net/pokemon/fused/50/50.26.png", left: "ライチュウ", right: "ディグダ" },
     { id: 79,   image: "https://images.alexonsager.net/pokemon/fused/85/85.33.png", left: "ニドリーノ", right: "ドードリオ" },
     { id: 80,   image: "https://images.alexonsager.net/pokemon/fused/43/43.79.png", left: "ヤドン", right: "ナゾノクサ" },
     { id: 81,   image: "https://images.alexonsager.net/pokemon/fused/13/13.130.png", left: "ギャラドス", right: "ビードル" },
     { id: 82,   image: "https://images.alexonsager.net/pokemon/fused/34/34.61.png", left: "ニョロゾ", right: "ニドキング" },
     { id: 83,   image: "https://images.alexonsager.net/pokemon/fused/122/122.25.png", left: "ピカチュウ", right: "バリヤード" },
     { id: 84,   image: "https://images.alexonsager.net/pokemon/fused/17/17.124.png", left: "ルージュラ", right: "ピジョン" },
     { id: 85,   image: "https://images.alexonsager.net/pokemon/fused/8/8.57.png", left: "オコリザル", right: "カメール" },
     { id: 86,   image: "https://images.alexonsager.net/pokemon/fused/1/1.48.png", left: "コンパン", right: "フシギダネ" },
     { id: 87,   image: "https://images.alexonsager.net/pokemon/fused/78/78.145.png", left: "サンダー", right: "ギャロップ" },
     { id: 88,   image: "https://images.alexonsager.net/pokemon/fused/129/129.25.png", left: "ピカチュウ", right: "コイキング" },
     { id: 89,   image: "https://images.alexonsager.net/pokemon/fused/12/12.55.png", left: "ゴルダック", right: "バタフリー" },
     { id: 90,   image: "https://images.alexonsager.net/pokemon/fused/82/82.109.png", left: "ドガース", right: "レアコイル" },
     { id: 91,   image: "https://images.alexonsager.net/pokemon/fused/142/142.34.png", left: "ニドキング", right: "プテラ" },
     { id: 92,   image: "https://images.alexonsager.net/pokemon/fused/145/145.63.png", left: "ケーシィ", right: "サンダー" },
     { id: 93,   image: "https://images.alexonsager.net/pokemon/fused/38/38.112.png", left: "サイドン", right: "キュウコン" },
     { id: 84,   image: "https://images.alexonsager.net/pokemon/fused/66/66.137.png", left: "ポリゴン", right: "ワンリキー" },
     { id: 85,   image: "https://images.alexonsager.net/pokemon/fused/68/68.128.png", left: "ケンタロス", right: "カイリキー" },
     { id: 86,   image: "https://images.alexonsager.net/pokemon/fused/34/34.108.png", left: "ベロリンガ", right: "ニドキング" },
     { id: 87,   image: "https://images.alexonsager.net/pokemon/fused/143/143.68.png", left: "カイリキー", right: "カビゴン" },
     { id: 88,   image: "https://images.alexonsager.net/pokemon/fused/45/45.80.png", left: "ヤドラン", right: "ラフレシア" },
     { id: 89,   image: "https://images.alexonsager.net/pokemon/fused/105/105.69.png", left: "マダツボミ", right: "ガラガラ" },
     { id: 90,   image: "https://images.alexonsager.net/pokemon/fused/15/15.110.png", left: "マタドガス", right: "スピアー" },
     { id: 91,   image: "https://images.alexonsager.net/pokemon/fused/113/113.110.png", left: "マタドガス", right: "ラッキー" },
     { id: 92,   image: "https://images.alexonsager.net/pokemon/fused/76/76.96.png", left: "スリープ", right: "ゴローニャ" },
     { id: 93,   image: "https://images.alexonsager.net/pokemon/fused/99/99.74.png", left: "イシツブテ", right: "キングラー" },
     { id: 94,   image: "https://images.alexonsager.net/pokemon/fused/23/23.149.png", left: "カイリュー", right: "アーボ" },
     { id: 95,   image: "https://images.alexonsager.net/pokemon/fused/86/86.13.png", left: "ビードル", right: "パウワウ" },
     { id: 96,   image: "https://images.alexonsager.net/pokemon/fused/129/129.109.png", left: "ドガース", right: "コイキング" },
     { id: 97,   image: "https://images.alexonsager.net/pokemon/fused/145/145.50.png", left: "ディグダ", right: "サンダー" },
     { id: 98,   image: "https://images.alexonsager.net/pokemon/fused/10/10.90.png", left: "シェルダー", right: "キャタピー" },
     { id: 99,   image: "https://images.alexonsager.net/pokemon/fused/109/109.124.png", left: "ルージュラ", right: "ドガース" },
     { id: 100,   image: "https://images.alexonsager.net/pokemon/fused/108/108.122.png", left: "バリヤード", right: "ベロリンガ" },
      // 好きなだけ追加OK
    ];

    let current = null;
    let score = 0;
    let correctCount = 0;
    let askedCount = 0;
    let timeLeft = 180; // ★ 3分
    let timerId = null;

    function normalize(str) {
      return (str || "").replace(/\s+/g, "").toLowerCase();
    }

    function pickNext() {
      if (!FUSIONS.length) return null;
      const idx = Math.floor(Math.random() * FUSIONS.length);
      return FUSIONS[idx];
    }

    function showQuestion() {
      const q = pickNext();
      const img = document.getElementById("fusion-image");
      const ans1 = document.getElementById("ans1");
      const ans2 = document.getElementById("ans2");
      const feedback = document.getElementById("feedback");

      if (!q) {
        feedback.textContent =
          "問題が設定されていません。FUSIONS 配列を編集してください。";
        img.src = "";
        return;
      }

      current = q;
      askedCount++;

      img.src = q.image;
      img.alt = "fusion #" + q.id;
      ans1.value = "";
      ans2.value = "";
      feedback.textContent = "";
    }

    function checkAnswer() {
      if (!current) return;
      const a1 = normalize(document.getElementById("ans1").value);
      const a2 = normalize(document.getElementById("ans2").value);
      const answers = [a1, a2];

      const left = normalize(current.left);
      const right = normalize(current.right);
      const correctSet = [left, right];

      // ★順不同OK
      const ok =
        answers.includes(correctSet[0]) && answers.includes(correctSet[1]);

      const feedback = document.getElementById("feedback");
      if (ok) {
        correctCount++;
        score += 100;
        feedback.textContent = `正解！ +100（正解 ${correctCount}問）`;
      } else {
        feedback.textContent = `ざんねん… 正解は「${current.left} × ${current.right}」`;
      }

      document.getElementById("score").textContent = score;
      showQuestion();
    }

    function passQuestion() {
      const feedback = document.getElementById("feedback");
      if (current) {
        feedback.textContent = `パスしました。正解は「${current.left} × ${current.right}」`;
      } else {
        feedback.textContent = "パスしました。";
      }
      showQuestion();
    }

    async function finishGame() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
      const controls = document.getElementById("controls");
      controls.style.pointerEvents = "none";
      controls.style.opacity = "0.6";

      const summary = `終了！ 正解 ${correctCount}問 / 出題 ${askedCount}問 / スコア ${score}`;
      document.getElementById("feedback").textContent = summary;

      const info = document.getElementById("result-info");
      try {
        const res = await submitScore("fusion", score, {
          correct: correctCount,
          total: askedCount,
        });
        if (res && res.ok !== false) {
          info.textContent = `サーバー送信完了：+${res.addedPoints ?? 0}pt（合計 ${
            res.totalPoints ?? "?"
          }pt）`;
        } else {
          info.textContent = "スコア送信に失敗しました。";
        }
      } catch (e) {
        console.error(e);
        info.textContent = "スコア送信に失敗しました。";
      }
    }

    function startGame() {
      if (!FUSIONS.length) {
        alert("問題が未設定です。FUSIONS 配列を編集してください。");
        return;
      }

      score = 0;
      correctCount = 0;
      askedCount = 0;
      timeLeft = 180; // ★ 3分

      document.getElementById("score").textContent = score;
      document.getElementById("time").textContent = timeLeft;
      document.getElementById("feedback").textContent = "";
      document.getElementById("result-info").textContent = "";

      const controls = document.getElementById("controls");
      controls.style.pointerEvents = "auto";
      controls.style.opacity = "1";

      if (timerId) clearInterval(timerId);
      timerId = setInterval(() => {
        timeLeft--;
        document.getElementById("time").textContent = timeLeft;
        if (timeLeft <= 0) {
          finishGame();
        }
      }, 1000);

      showQuestion();
    }

    document.addEventListener("DOMContentLoaded", () => {
      document
        .getElementById("start-btn")
        .addEventListener("click", startGame);
      document
        .getElementById("submit-btn")
        .addEventListener("click", checkAnswer);
      document
        .getElementById("pass-btn")
        .addEventListener("click", passQuestion);
    });
  </script>

  <script>
    // ダブルタップ拡大防止（他ページと同じ）
    let __lastTouchEnd = 0;
    document.addEventListener(
      "touchend",
      function (e) {
        const now = Date.now();
        if (now - __lastTouchEnd <= 300) {
          e.preventDefault();
        }
        __lastTouchEnd = now;
      },
      { passive: false }
    );
  </script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ポケモンフュージョンクイズ</h1>
      <a class="game" href="/">← メニューへ</a>
    </div>

    <div class="card">
      <div class="list">
        <div class="small">
          3分間、表示されたフュージョンの元ポケモン2匹の名前を入力しよう！<br />
          左右どちらの欄にどの名前を入れてもOKです。
        </div>

        <div
          class="card"
          style="display:flex;flex-direction:column;align-items:center;gap:8px;"
        >
          <img
            id="fusion-image"
            src=""
            alt="fusion"
            style="max-width:220px;max-height:220px;object-fit:contain;
                    background:#000;border-radius:12px;padding:8px;"
          />

          <div
            id="controls"
            style="display:flex;gap:8px;align-items:flex-start;pointer-events:none;opacity:0.6;"
          >
            <div
              style="flex:1;display:flex;flex-direction:column;gap:4px;"
            >
              <input id="ans1" type="text" placeholder="ポケモン名1" />
              <input id="ans2" type="text" placeholder="ポケモン名2" />
            </div>
            <div style="display:flex;flex-direction:column;gap:6px;">
              <button id="submit-btn">回答</button>
              <button id="pass-btn">パス</button>
            </div>
          </div>

          <div class="kv">
            <span class="badge">残り <b id="time">180</b>s</span>
            <span class="badge">スコア <b id="score">0</b></span>
          </div>

          <div id="feedback" class="small"></div>
          <div id="result-info" class="small"></div>
        </div>

        <div class="kv">
          <button id="start-btn">スタート</button>
        </div>

        <div class="small">
          
        </div>
      </div>
    </div>
  </div>
</body>
</html>
