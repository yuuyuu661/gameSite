<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Leaderboards</title>
  <link rel="stylesheet" href="/style.css"/>
  <script type="module">
    import { getLeaderboard } from "/js/common.js";
    const games = ["aim","memory","numbers","fusion"];

    async function load() {
      const wrap = document.querySelector("#wrap");
      wrap.innerHTML = "";
      for (const g of games) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<h3>${g.toUpperCase()}</h3><div class="list" id="list-${g}"><div class="small">èª­ã¿è¾¼ã¿ä¸­â€¦</div></div>`;
        wrap.appendChild(card);

        try {
          const data = await getLeaderboard(g);
          const list = card.querySelector("#list-" + g);
          const records = data.records || [];
          if (!records.length) {
            list.innerHTML = "<div class='small'>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>";
            continue;
          }
          list.innerHTML = records.map((r, i) => {
            const meta = r.meta || {};
            let extra = "";
            if (g === "fusion") {
              if (typeof meta.correct === "number") {
                extra = ` â€” æ­£è§£ ${meta.correct}å•`;
              }
            } else {
              if (typeof meta.sec === "number") {
                extra = ` â€” ${meta.sec.toFixed(2)}s`;
              }
            }
            return `<div class="kv"><span>#${i+1} ${r.player}</span><b>${r.score}${extra}</b></div>`;
          }).join("");
        } catch (e) {
          console.error(e);
        }
      }
    }

    document.addEventListener("DOMContentLoaded", load);
  </script>
  <script>
    let __lastTouchEnd = 0;
    document.addEventListener('touchend', function (e) {
      const now = Date.now();
      if (now - __lastTouchEnd <= 300) { e.preventDefault(); }
      __lastTouchEnd = now;
    }, { passive: false });
  </script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ† Leaderboards</h1>
      <a class="game" href="/">â† æˆ»ã‚‹</a>
    </div>
    <div id="wrap" class="grid"></div>
  </div>
</body>
</html>
