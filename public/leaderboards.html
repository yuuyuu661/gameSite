<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
  <title>Leaderboards</title>
  <link rel="stylesheet" href="/style.css"/>

  <style>
    .gold-card {
    border: 4px solid gold;
    background: #fff7d1;
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 20px;
  }

  .rank-1 { color: #d4af37; font-weight: bold; }   /* é‡‘ */
  .rank-2 { color: #c0c0c0; font-weight: bold; }   /* éŠ€ */
  .rank-3 { color: #b87333; font-weight: bold; }   /* éŠ… */
  .rank-else { color: #000; }                      /* 4ä½ï½é»’ */
    }
  </style>

<script type="module">
  import { getLeaderboard } from "/js/common.js";

  async function loadPointsRanking() {
    const box = document.querySelector("#points-ranking");
    box.innerHTML = "<div class='small'>èª­ã¿è¾¼ã¿ä¸­...</div>";
    try {
      const res = await fetch("/api/points-ranking");
      const data = await res.json();
      let list = data.ranking || [];

      // â–¼ 10 ä½ã¾ã§ã«åˆ¶é™
      list = list.slice(0, 10);

      if (!list.length) {
        box.innerHTML = "<div class='small'>ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>";
        return;
      }

      box.innerHTML = list.map((r, i) => {
        let cls = "rank-else";
        if (i === 0) cls = "rank-1";
        else if (i === 1) cls = "rank-2";
        else if (i === 2) cls = "rank-3";

        return `
          <div class="kv ${cls}">
            <span>#${i + 1} ${r.player}</span>
            <b>${r.points}pt</b>
          </div>
        `;
      }).join("");

    } catch (err) {
      console.error(err);
      box.innerHTML = "<div class='small'>ã‚¨ãƒ©ãƒ¼</div>";
    }
  }

  async function loadGameRankings() {
    const games = ["aim","memory","numbers","fusion","block"];
    const wrap = document.querySelector("#wrap");
    wrap.innerHTML = "";

    for (const g of games) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${g.toUpperCase()}</h3>
        <div class="list" id="list-${g}"><div class="small">èª­ã¿è¾¼ã¿ä¸­â€¦</div></div>
      `;
      wrap.appendChild(card);

      try {
        const data = await getLeaderboard(g);
        const list = card.querySelector("#list-" + g);
        const records = data.records || [];

        if (!records.length) {
          list.innerHTML = "<div class='small'>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>";
          continue;
        }

        list.innerHTML = records.map((r,i)=>`
          <div class="kv">
            <span>#${i+1} ${r.player}</span>
            <b>${r.score}</b>
          </div>
        `).join("");

      } catch (e) {
        console.error(e);
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadPointsRanking();
    loadGameRankings();
  });
</script>

</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ† Leaderboards</h1>
      <a class="game" href="/">â† æˆ»ã‚‹</a>
    </div>

    <!-- â˜… æ‰€æŒãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆç‰¹åˆ¥é‡‘æ ï¼‰ -->
    <div class="gold-card">
      <h2>æ‰€æŒãƒã‚¤ãƒ³ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
      <div id="points-ranking"></div>
    </div>

    <!-- å„ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
    <div id="wrap" class="grid"></div>

  </div>
</body>
</html>
